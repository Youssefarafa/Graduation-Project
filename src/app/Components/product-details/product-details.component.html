<ngx-spinner bdColor="rgba(0, 0, 0, 0.85)" name="rating" size="default" color="#22c55e" type="ball-spin-clockwise"
    [fullScreen]="true">
    <p class="text-xl text-center text-green-500 mt-[-40px] font-Quicksand">Updating Rating...</p>
</ngx-spinner>
<div
    class="my-14 mx-8 max-w-4xl sm:w-[75%] md:max-w-4xl flex flex-col md:flex-row items-start gap-6 p-4 border rounded-lg shadow-md sm:mx-auto bg-white dark:bg-green-950 border-green-200 dark:border-green-800 transition-colors duration-300">
    <!-- Product Image -->
    <div class="w-full md:w-1/3">
        <div class="mt-4 ps-[-12px] sm:ps-8">
            <div class="border-0 me-[24px] sm:me-[12px] ms-[24px] sm:ms-[0px] rounded-md overflow-hidden">
                <owl-carousel-o [options]="customOptions">
                    <!-- Loop through ProductDetails?.images or fallback to ProductDetails?.image -->
                    <ng-container *ngIf="ProductDetails?.images?.length > 0; else fallbackImage">
                        <ng-container *ngFor="let slide of ProductDetails?.images; let i = index">
                            <ng-template carouselSlide [id]="'image' + i">
                                <div class="h-[200px]">
                                    <img [ngSrc]="slide ? slide : './assets/Images/grayloude.jpg'" fill priority
                                        class="h-full w-full" [alt]="ProductDetails?.title"
                                        [title]="ProductDetails?.title">
                                </div>
                            </ng-template>
                        </ng-container>
                    </ng-container>
                    <!-- Fallback when ProductDetails?.images is empty -->
                    <ng-template #fallbackImage>
                        <ng-template carouselSlide [id]="'image0'">
                            <div class="h-[200px]">
                                <img [ngSrc]="ProductDetails?.imageCover ? ProductDetails?.imageCover : './assets/Images/grayloude.jpg'"
                                    fill priority class="h-full w-full" [alt]="ProductDetails?.title"
                                    [title]="ProductDetails?.title">
                            </div>
                        </ng-template>
                    </ng-template>
                </owl-carousel-o>
            </div>
        </div>
    </div>
    <!-- Product Info -->
    <div class="w-full md:w-2/3 flex flex-col gap-2 text-green-900 dark:text-green-100">
        <!-- Title -->
        <div class="flex items-center gap-4 justify-between mt-2">
            <h2 class="text-xl font-bold font-Roboto ">
                {{ProductDetails?.title}}
            </h2>
            <!-- Wishlist -->
            <app-button-wish [product]="ProductDetails"></app-button-wish>
        </div>
        <!-- Description -->
        <p class="text-sm text-green-800 dark:text-green-200 font-Roboto ">
            {{ProductDetails?.description}}
        </p>
        <!-- Category -->
        <div class="text-green-600 dark:text-green-300 text-sm font-Roboto ">{{ProductDetails?.category.name}}</div>
        <div class="text-green-500 dark:text-green-400 text-xs font-bold font-Signika">{{ProductDetails?.quantity}}
            piece</div>
        <div class="flex items-center gap-4 justify-between mt-2">
            <!-- Price -->
            <div class="text-lg font-bold text-green-900 dark:text-green-100 font-Signika">{{ProductDetails?.price}} EGP
            </div>
            <!-- Rating -->
            <div class="flex items-center gap-1 font-Signika hover:cursor-pointer" (click)="openRatingModal(ProductDetails._id)">
                <ng-container *ngFor="let star of stars">
                    <!-- Full Star -->
                    <svg *ngIf="star === 'full'" class="w-5 h-5 text-yellow-500" fill="currentColor"
                        viewBox="0 0 20 20">
                        <path
                            d="M10 15l-5.878 3.09 1.122-6.545L.488 6.91l6.561-.954L10 0l2.951 5.956 6.561.954-4.756 4.635 1.122 6.545z" />
                    </svg>
                    <!-- Half Star -->
                    <svg *ngIf="star === 'half'" class="w-5 h-5 text-yellow-500" viewBox="0 0 20 20">
                        <defs>
                            <linearGradient id="half">
                                <stop offset="50%" stop-color="currentColor" />
                                <stop offset="50%" stop-color="#d1d5db" />
                            </linearGradient>
                        </defs>
                        <path fill="url(#half)"
                            d="M10 15l-5.878 3.09 1.122-6.545L.488 6.91l6.561-.954L10 0l2.951 5.956 6.561.954-4.756 4.635 1.122 6.545z" />
                    </svg>
                    <!-- Empty Star -->
                    <svg *ngIf="star === 'empty'" class="w-5 h-5 text-gray-300 " fill="currentColor"
                        viewBox="0 0 20 20">
                        <path
                            d="M10 15l-5.878 3.09 1.122-6.545L.488 6.91l6.561-.954L10 0l2.951 5.956 6.561.954-4.756 4.635 1.122 6.545z" />
                    </svg>
                </ng-container>
                {{ ProductDetails?.ratingsAverage }}
            </div>
        </div>
        <!-- Rating Modal Triggered -->
        <div  *ngIf="userRating && showRatingModal==false" class="hover:cursor-default flex items-center justify-center text-sm w-full gap-1 font-Signika">
            Your Estimate :-  <div class="ms-4"></div>
            <div  class=" hover:cursor-pointer flex  space-x-[2px] " (click)="openRatingModal(ProductDetails._id)">
                <ng-container *ngFor="let star of starshis">
                    <!-- Full Star -->
                    <svg *ngIf="star === 'full'" class="w-3 h-3 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                        <path
                            d="M10 15l-5.878 3.09 1.122-6.545L.488 6.91l6.561-.954L10 0l2.951 5.956 6.561.954-4.756 4.635 1.122 6.545z" />
                    </svg>
                    <!-- Half Star -->
                    <svg *ngIf="star === 'half'" class="w-3 h-3 text-yellow-500" viewBox="0 0 20 20">
                        <defs>
                            <linearGradient id="half">
                                <stop offset="50%" stop-color="currentColor" />
                                <stop offset="50%" stop-color="#d1d5db" />
                            </linearGradient>
                        </defs>
                        <path fill="url(#half)"
                            d="M10 15l-5.878 3.09 1.122-6.545L.488 6.91l6.561-.954L10 0l2.951 5.956 6.561.954-4.756 4.635 1.122 6.545z" />
                    </svg>
                    <!-- Empty Star -->
                    <svg *ngIf="star === 'empty'" class="w-3 h-3 text-gray-300 " fill="currentColor" viewBox="0 0 20 20">
                        <path
                            d="M10 15l-5.878 3.09 1.122-6.545L.488 6.91l6.561-.954L10 0l2.951 5.956 6.561.954-4.756 4.635 1.122 6.545z" />
                    </svg>
                </ng-container>
            </div>
            {{ userRating }}
        </div>
        <!-- Add to Cart -->
        <button (click)="AddToCart(ProductDetails._id)" [disabled]="isClick"
            class="bg-green-600 font-Philosopher hover:bg-green-700 disabled:cursor-not-allowed disabled:bg-green-500 active:bg-green-800 text-white w-full text-md font-medium px-5 py-2 rounded mt-2 transition-colors duration-200">
            Add To Cart
        </button>
    </div>
</div>
<div
    class="container mx-auto ps-[-12px] sm:ps-8 pe-[8px] sm:pe-[12px] py-6 mt-5 transition-colors duration-300 flex flex-col justify-center">
    <h3 class="w-full text-2xl font-bold font-Roboto  pb-5 ps-[12px] sm:ps-0 text-green-800 dark:text-green-300">
        Anouther Related Products:</h3>
    <!-- Responsive Grid for Products -->
    <app-show-produts [products]="ProductsShop" [isProductDetails]="true"></app-show-produts>
</div>
<!-- Rating Modal -->
<div *ngIf="showRatingModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
    <div class="bg-white dark:bg-green-900 p-6 rounded-xl w-[90%] max-w-md shadow-lg relative">
        <h3 class="text-lg font-Roboto font-semibold text-center text-green-900 dark:text-green-100 mb-4">
            Rate This Product
        </h3>

        <div class="flex justify-center gap-2 my-4">
            <ng-container *ngFor="let star of [1,2,3,4,5]">
                <svg (click)="userRating = star"
                    [ngClass]="{'text-yellow-500': userRating >= star, 'text-gray-300': userRating < star}"
                    class="w-8 h-8 cursor-pointer transition-colors duration-200" fill="currentColor"
                    viewBox="0 0 20 20">
                    <path
                        d="M10 15l-5.878 3.09 1.122-6.545L.488 6.91l6.561-.954L10 0l2.951 5.956 6.561.954-4.756 4.635 1.122 6.545z" />
                </svg>
            </ng-container>
        </div>

        <div class="flex justify-around gap-4">
            <button (click)="clearRating()"
                class="bg-gray-400 text-white py-2 px-4 rounded-md hover:bg-gray-500 transition-colors">
                <div *ngIf="userRating > 0">Clear</div>
                <div *ngIf="userRating <= 0">Cancel</div>
            </button>
            <button *ngIf="userRating > 0" (click)="submitRating()"
                class="bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition-colors">
                Submit
            </button>
        </div>
    </div>
</div>
